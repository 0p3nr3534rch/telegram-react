(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{730:function(e,t,n){},731:function(e,t,n){},732:function(e,t,n){},738:function(e,t,n){"use strict";n.r(t);var r=n(126),a=n(14),s=n.n(a),i=n(24),o=n(7),c=n(9),l=n(11),u=n(10),p=n(12),d=n(0),h=n.n(d),k=n(8),f=n.n(k),m=n(55),v=n(5),S=n.n(v),b=n(39),g=n(32),w=n.n(g),E=n(73),j=n.n(E),y=n(475),C=n.n(y),P=n(735),O=n(423),M=n(401),x=n(29),I=n(400),N=(n(730),function(e){function t(){var e,n;Object(o.a)(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).loadContent=function(){var e=n.props.info;if(e){var t=e.stickers;if(t){var r=I.a.getStore();t.forEach(function(e){Object(M.q)(r,e,null)})}}},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t,n){return this.props.info!==e.info}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.info,r=e.onSelect,a=e.onMouseDown;if(!n)return null;var s=n.title,i=n.stickers.map(function(e){return h.a.createElement("div",{className:f()("sticker-set-item",t.stickerSetItem),key:e.sticker.id,"data-sticker-id":e.sticker.id,onClick:function(){return r(e)},onMouseDown:a},h.a.createElement(O.a,{key:e.sticker.id,className:"sticker-set-item-sticker",sticker:e,displaySize:x.V-6,blur:!1}))});return h.a.createElement("div",{className:"sticker-set"},h.a.createElement("div",{className:f()("sticker-set-title",t.title)},h.a.createElement("span",null,s)),h.a.createElement("div",{className:"sticker-set-content"},i))}}]),t}(h.a.Component)),R=S()(function(e){return{title:{backgroundColor:e.palette.background.paper,color:e.palette.text.primary},stickerSetItem:{width:x.V,height:x.V,padding:3,boxSizing:"border-box","&:hover":{background:"dark"===e.palette.type?"#303030":"#f4f4f4",borderRadius:6}}}})(N),U=n(480),D=n(2),T=(n(731),n(30)),L=n(33),B=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).loadContent=function(){var e=Object(i.a)(s.a.mark(function e(t,r){var a,i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.stickerSets){e.next=2;break}return e.abrupt("return");case 2:if(r){e.next=11;break}return e.next=5,D.a.send({"@type":"getInstalledStickerSets",is_masks:!1});case 5:return a=e.sent,i=[],a.sets.forEach(function(e){i.push(D.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=10,Promise.all(i);case 10:r=e.sent;case 11:o=r.slice(0,5),n.setState({stickerSets:t,sets:o}),n.setsLength=o.length;case 14:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.updateItemsInView=function(){var e=n.scrollRef.current,t=n.state.sets,r=[];t.forEach(function(t){var a=n.itemsMap.get(t.id),s=L.findDOMNode(a);if(s){var i=e.scrollTop-800,o=e.scrollTop+e.offsetHeight+800,c=s.offsetTop,l=s.offsetTop+s.clientHeight;c>=i&&s.offsetTop<=o?r.push(t):l>=i&&l<=o?r.push(t):c<=i&&l>=o&&r.push(t)}}),console.log("Stickers.inViewItems",r),r.forEach(function(e){var t=I.a.getStore();Object(M.r)(t,e)})},n.handleScroll=Object(i.a)(s.a.mark(function e(){var t,r,a,i,o,c,l,u,p;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.updateItemsInView(),t=n.scrollRef.current,!n.loadingChunk){e.next=4;break}return e.abrupt("return");case 4:if(r=!1,t.scrollTop+t.offsetHeight>=t.scrollHeight-400&&(r=!0),r){e.next=8;break}return e.abrupt("return",!1);case 8:if(a=n.state,i=a.sets,(o=a.stickerSets).sets.length!==i.length){e.next=11;break}return e.abrupt("return");case 11:return n.loadingChunk=!0,c=Date.now(),l=[],o.sets.slice(n.setsLength,n.setsLength+5).forEach(function(e){l.push(D.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=17,Promise.all(l).finally(function(){return n.loadingChunk=!1});case 17:u=e.sent,n.setsLength+=u.length,console.log("StickersPicker.handleScroll",Date.now()-c,i.concat(u),o),p=i.concat(u),n.setState({sets:p});case 22:case"end":return e.stop()}},e)})),n.getItems=function(e){var t=[];return e.forEach(function(e){e.stickers.forEach(function(e){t.push(e)})}),t},n.loadPreviewContent=function(e){var t=n.state.sets,r=n.getItems(t).find(function(t){return t.sticker.id===e});if(r){var a=I.a.getStore();Object(M.q)(a,r,null);D.a.send({"@type":"getStickerEmojis",sticker:{"@type":"inputFileId",id:e}}).then(function(t){n.state.previewStickerId===e&&n.setState({previewStickerEmojis:t.emojis.join(" ")})})}},n.handleMouseOver=function(e){},n.handleMouseOut=function(e){},n.handleMouseDown=function(e){var t=Number(e.target.dataset.stickerId);if(console.log("Stickers.handleMouseDown",t),t){n.mouseDownStickerId=t;var r=Date.now();return n.setState({previewStickerId:t,timestamp:r,showPreview:!1,cancelSend:!1}),setTimeout(function(){n.state.timestamp===r&&n.setState({showPreview:!0,cancelSend:!0})},500),n.loadPreviewContent(t),n.mouseDown=!0,e.preventDefault(),e.stopPropagation(),!1}},n.handleMouseUp=function(){n.setState({previewStickerId:0,timestamp:0,showPreview:!1}),n.mouseDown=!1,document.removeEventListener("mouseup",n.handleMouseUp)},n.scrollRef=h.a.createRef(),n.itemsMap=new Map,n.state={stickerSets:null,sets:[],position:0},n.updateItemsInView=Object(T.c)(n.updateItemsInView,100),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t,n){var r=this.state,a=r.stickerSets,s=r.sets,i=r.showPreview;return t.stickerSets!==a||(t.sets!==s||t.showPreview!==i)}},{key:"render",value:function(){var e=this,t=this.props.onSelect,n=this.state,r=n.stickerSets,a=n.sets,s=n.previewStickerId,i=n.showPreview,o=n.previewStickerEmojis;n.position;if(!r)return null;if(!a)return null;if(!a.length)return null;this.itemsMap.clear();var c=a.map(function(n){return h.a.createElement(R,{key:n.id,ref:function(t){return e.itemsMap.set(n.id,t)},info:n,onSelect:t})}),l=this.getItems(a).find(function(e){return e.sticker.id===s});return h.a.createElement("div",{className:"stickers-picker"},h.a.createElement("div",{className:"stickers-picker-header"}),h.a.createElement("div",{ref:this.scrollRef,className:"stickers-picker-scroll",onScroll:this.handleScroll},c),Boolean(l)&&i&&h.a.createElement("div",{className:"sticker-set-dialog-preview"},h.a.createElement("div",{className:"sticker-set-dialog-preview-emoji"},o),h.a.createElement(U.a,{sticker:l,displaySize:x.U})))}}]),t}(h.a.Component),V=n(28),F=n(89),_=(n(732),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onClientUpdateChange=function(e){n.picker=null},n.handleButtonMouseEnter=function(e){n.buttonEnter=!0,setTimeout(function(){n.buttonEnter&&(n.updatePicker(!0),n.loadStickerSets())},x.d)},n.loadStickerSets=Object(i.a)(s.a.mark(function e(){var t,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.sets){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,D.a.send({"@type":"getInstalledStickerSets",is_masks:!1});case 4:return n.stickerSets=e.sent,t=[],n.stickerSets.sets.forEach(function(e){t.push(D.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=9,Promise.all(t);case 9:n.sets=e.sent,r=I.a.getStore(),n.sets.slice(0,5).reverse().forEach(function(e){Object(M.r)(r,e)});case 13:case"end":return e.stop()}},e)})),n.handleButtonMouseLeave=function(){n.buttonEnter=!1,setTimeout(function(){n.paperEnter||n.buttonEnter||n.updatePicker(!1)},x.d)},n.handlePaperMouseEnter=function(){n.paperEnter=!0},n.handlePaperMouseLeave=function(){n.paperEnter=!1,setTimeout(function(){n.paperEnter||n.buttonEnter||n.updatePicker(!1)},x.d)},n.updatePicker=function(e){n.setState({open:e})},n.switchPicker=function(){n.updatePicker(!n.state.open)},n.handleEmojiClick=function(){n.setState({tab:0})},n.handleStickersClick=function(){n.stickersPickerRef.current.loadContent(n.stickerSets,n.sets),n.setState({tab:1})},n.handleStickerSend=function(e){e&&(D.a.clientUpdate({"@type":"clientUpdateStickerSend",sticker:e}),n.updatePicker(!1))},n.state={open:!1,tab:0},n.stickersPickerRef=h.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){V.a.on("clientUpdateThemeChange",this.onClientUpdateChange),F.a.on("clientUpdateLanguageChange",this.onClientUpdateChange)}},{key:"componentWillUnmount",value:function(){V.a.removeListener("clientUpdateThemeChange",this.onClientUpdateChange),F.a.removeListener("clientUpdateLanguageChange",this.onClientUpdateChange)}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme,a=e.t,s=this.state,i=s.open,o=s.tab;if(i&&!this.picker){var c={search:a("Search"),notfound:a("NotEmojiFound"),skintext:a("ChooseDefaultSkinTone"),categories:{search:a("SearchResults"),recent:a("Recent"),people:a("SmileysPeople"),nature:a("AnimalsNature"),foods:a("FoodDrink"),activity:a("Activity"),places:a("TravelPlaces"),objects:a("Objects"),symbols:a("Symbols"),flags:a("Flags"),custom:a("Custom")}};this.picker=h.a.createElement(P.a,{set:"apple",showPreview:!1,showSkinTones:!1,onSelect:this.props.onSelect,color:n.palette.primary.dark,i18n:c,style:{width:338,overflowX:"hidden"}}),this.stickersPicker=h.a.createElement(B,{ref:this.stickersPickerRef,onSelect:this.handleStickerSend})}return h.a.createElement(h.a.Fragment,null,h.a.createElement("link",{rel:"stylesheet",type:"text/css",href:"dark"===n.palette.type?"emoji-mart.dark.css":"emoji-mart.light.css"}),h.a.createElement(j.a,{className:t.iconButton,"aria-label":"Emoticon",onClick:this.switchPicker,onMouseEnter:this.handleButtonMouseEnter,onMouseLeave:this.handleButtonMouseLeave},h.a.createElement(C.a,null)),h.a.createElement("div",{className:f()(t.pickerRoot,Object(r.a)({},t.pickerRootOpened,i)),onMouseEnter:this.handlePaperMouseEnter,onMouseLeave:this.handlePaperMouseLeave},h.a.createElement("div",{className:"emoji-picker-header"},h.a.createElement(w.a,{color:0===o?"primary":"default",className:t.headerButton,onClick:this.handleEmojiClick},a("Emoji")),h.a.createElement(w.a,{color:1===o?"primary":"default",className:t.headerButton,onClick:this.handleStickersClick},a("Stickers"))),h.a.createElement("div",{className:f()("emoji-picker-content",{"emoji-picker-content-stickers":1===o})},this.picker,this.stickersPicker)))}}]),t}(h.a.Component)),H=Object(m.a)(S()(function(e){return{iconButton:{margin:"8px 0px"},headerButton:{borderRadius:0,flex:"50%"},pickerRoot:{width:338,overflowX:"hidden",backgroundColor:e.palette.background.paper,color:e.palette.text.primary,borderRadius:e.shape.borderRadius,boxShadow:e.shadows[8],position:"absolute",bottom:80,display:"none"},pickerRootOpened:{display:"block"}}},{withTheme:!0}),Object(b.c)());t.default=H(_)}}]);
//# sourceMappingURL=5.ecf0ae8a.chunk.js.map