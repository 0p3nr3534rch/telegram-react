(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{409:function(e,t,a){"use strict";var n=a(7),o=a(10),r=a(12),s=a(11),c=a(13),i=a(0),l=a.n(i),u=a(53),d=a(391),p=a(69),h=(a(422),function(e){function t(){var e,a;Object(n.a)(this,t);for(var o=arguments.length,c=new Array(o),i=0;i<o;i++)c[i]=arguments[i];return(a=Object(r.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(c)))).onFastUpdatingComplete=function(e){a.forceUpdate()},a.onUpdateChatTitle=function(e){var t=a.props.chatId;e.chat_id===t&&a.forceUpdate()},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId||e.t!==this.props.t}},{key:"componentDidMount",value:function(){p.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),p.a.on("updateChatTitle",this.onUpdateChatTitle)}},{key:"componentWillUnmount",value:function(){p.a.removeListener("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),p.a.removeListener("updateChatTitle",this.onUpdateChatTitle)}},{key:"render",value:function(){var e=this.props,t=e.t,a=e.chatId,n=e.showSavedMessages,o=Object(d.q)(a,n,t);return l.a.createElement("div",{className:"dialog-title"},o)}}]),t}(l.a.Component));h.defaultProps={showSavedMessages:!0},t.a=Object(u.c)()(h)},415:function(e,t,a){"use strict";var n=a(7),o=a(10),r=a(12),s=a(11),c=a(13),i=a(0),l=a.n(i),u=a(404),d=a(409),p=a(8),h=a.n(p),m=a(6),g=a.n(m),f=a(391),C=a(69),v=a(45),b=a(408),y=a(401),U=(a(423),function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onUpdateUserStatus=function(e){var t=a.props.chatId,n=C.a.get(t);if(n&&n.type){var o=!1;switch(n.type["@type"]){case"chatTypeBasicGroup":var r=b.a.getFullInfo(n.type.basic_group_id);if(r&&r.members)r.members.find(function(t){return t.user_id===e.user_id})&&(o=!0);break;case"chatTypePrivate":case"chatTypeSecret":n.type.user_id===e.user_id&&(o=!0)}o&&a.updateSubtitle(n)}},a.updateSubtitle=function(e){a.setState({subtitle:Object(f.p)(e.id),isAccent:Object(f.K)(e.id)})},a.onUpdateUserFullInfo=function(e){var t=a.props.chatId,n=C.a.get(t);n&&(!n.type||"chatTypePrivate"!==n.type["@type"]&&"chatTypeSecret"!==n.type["@type"]||n.type.user_id!==e.user_id||a.updateSubtitle(n))},a.onUpdateBasicGroupFullInfo=function(e){var t=a.props.chatId,n=C.a.get(t);n&&n.type&&"chatTypeBasicGroup"===n.type["@type"]&&n.type.basic_group_id===e.basic_group_id&&a.updateSubtitle(n)},a.onUpdateSupergroupFullInfo=function(e){var t=a.props.chatId,n=C.a.get(t);n&&n.type&&"chatTypeSupergroup"===n.type["@type"]&&n.type.supergroup_id===e.supergroup_id&&a.updateSubtitle(n)},a.onUpdateBasicGroup=function(e){var t=a.props.chatId,n=C.a.get(t);n&&n.type&&"chatTypeBasicGroup"===n.type["@type"]&&n.type.basic_group_id===e.basic_group.id&&a.updateSubtitle(n)},a.onUpdateSupergroup=function(e){var t=a.props.chatId,n=C.a.get(t);n&&n.type&&"chatTypeSupergroup"===n.type["@type"]&&n.type.supergroup_id===e.supergroup.id&&a.updateSubtitle(n)};var o=a.props.chatId;return a.state={prevChatId:o,subtitle:Object(f.p)(o),isAccent:Object(f.K)(o)},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var a=this.props.chatId,n=this.state,o=n.subtitle,r=n.isAccent;return e.chatId!==a||(t.subtitle!==o||t.isAccent!==r)}},{key:"componentDidMount",value:function(){v.a.on("updateUserStatus",this.onUpdateUserStatus),b.a.on("updateBasicGroup",this.onUpdateBasicGroup),y.a.on("updateSupergroup",this.onUpdateSupergroup),v.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),b.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),y.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}},{key:"componentWillUnmount",value:function(){v.a.removeListener("updateUserStatus",this.onUpdateUserStatus),b.a.removeListener("updateBasicGroup",this.onUpdateBasicGroup),y.a.removeListener("updateSupergroup",this.onUpdateSupergroup),v.a.removeListener("updateUserFullInfo",this.onUpdateUserFullInfo),b.a.removeListener("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),y.a.removeListener("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}},{key:"render",value:function(){var e=this.props.classes,t=this.state,a=t.subtitle,n=t.isAccent;return l.a.createElement("div",{className:h()("dialog-status",n?e.statusAccentSubtitle:e.statusSubtitle)},a)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(e.chatId!==t.prevChatId){var a=e.chatId;return{prevChatId:a,subtitle:Object(f.p)(a),isAccent:Object(f.K)(a)}}return null}}]),t}(l.a.Component)),S=g()(function(e){return{statusSubtitle:{color:"dark"===e.palette.type?e.palette.text.secondary:"#70777b"},statusAccentSubtitle:{color:e.palette.primary.dark+"!important"}}},{withTheme:!0})(U),I=(a(424),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).handleClick=function(){var e=a.props,t=e.chatId,n=e.onSelect;if(n){var o=C.a.get(t);o&&n(o)}},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId}},{key:"render",value:function(){var e=this.props,t=e.chatId,a=e.onTileSelect,n=e.showStatus,o=e.showSavedMessages;return l.a.createElement("div",{className:"chat",onClick:this.handleClick},l.a.createElement("div",{className:"chat-wrapper"},l.a.createElement(u.a,{chatId:t,onSelect:a,showSavedMessages:o}),l.a.createElement("div",{className:"dialog-inner-wrapper"},l.a.createElement("div",{className:"tile-first-row"},l.a.createElement(d.a,{chatId:t,showSavedMessages:o})),n&&!o&&l.a.createElement("div",{className:"tile-second-row"},l.a.createElement(S,{chatId:t})))))}}]),t}(l.a.Component));I.defaultProps={showSavedMessages:!0,showStatus:!0};t.a=I},422:function(e,t,a){},423:function(e,t,a){},424:function(e,t,a){},456:function(e,t,a){"use strict";a.d(t,"a",function(){return o}),a.d(t,"b",function(){return s});var n=null;function o(e){if(!e)return null;if(!e.length)return null;n=n||new Map([["q","\u0439"],["w","\u0446"],["e","\u0443"],["r","\u043a"],["t","\u0435"],["y","\u043d"],["u","\u0433"],["i","\u0448"],["o","\u0449"],["p","\u0437"],["[","\u0445"],["]","\u044a"],["a","\u0444"],["s","\u044b"],["d","\u0432"],["f","\u0430"],["g","\u043f"],["h","\u0440"],["j","\u043e"],["k","\u043b"],["l","\u0434"],[";","\u0436"],["'","\u044d"],["\\","\u0451"],["z","\u044f"],["x","\u0447"],["c","\u0441"],["v","\u043c"],["b","\u0438"],["n","\u0442"],["m","\u044c"],[",","\u0431"],[".","\u044e"]]);for(var t="",a=0;a<e.length;a++){if(!n.has(e[a]))return null;t+=n.get(e[a])}return""===t?null:t}var r=null;function s(e){if(!e)return null;if(!e.length)return null;r=r||new Map([["\u0439","q"],["\u0446","w"],["\u0443","e"],["\u043a","r"],["\u0435","t"],["\u043d","y"],["\u0433","u"],["\u0448","i"],["\u0449","o"],["\u0437","p"],["\u0445","["],["\u044a","]"],["\u0444","a"],["\u044b","s"],["\u0432","d"],["\u0430","f"],["\u043f","g"],["\u0440","h"],["\u043e","j"],["\u043b","k"],["\u0434","l"],["\u0436",";"],["\u044d","'"],["\u0451","\\"],["\u044f","z"],["\u0447","x"],["\u0441","c"],["\u043c","v"],["\u0438","b"],["\u0442","n"],["\u044c","m"],["\u0431",","],["\u044e","."]]);for(var t="",a=0;a<e.length;a++){if(!r.has(e[a]))return null;t+=r.get(e[a])}return""===t?null:t}},470:function(e,t,a){},645:function(e,t,a){},646:function(e,t,a){},647:function(e,t,a){},648:function(e,t,a){},649:function(e,t,a){},650:function(e,t,a){},676:function(e,t,a){},677:function(e,t,a){},678:function(e,t,a){},679:function(e,t,a){},680:function(e,t,a){},681:function(e,t,a){},725:function(e,t,a){"use strict";a.r(t);var n=a(7),o=a(10),r=a(12),s=a(11),c=a(13),i=a(0),l=a.n(i),u=a(8),d=a.n(u),p=a(6),h=a.n(p),m=a(395),g=a(55),f=a(14),C=a.n(f),v=a(429),b=a(24),y=a(77),U=a(53),S=a(402),I=a.n(S),k=a(120),O=a.n(k),E=a(415),j=a(404),x=a(391),_=(a(645),function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.classes,e.chatId),a=e.onSelect,n=e.showSavedMessages,o=Object(x.n)(t,n);return l.a.createElement("div",{className:"top-chat"},l.a.createElement(j.a,{chatId:t,onSelect:a,showSavedMessages:n,showOnline:!0}),l.a.createElement("div",{className:"top-chat-title"},o))}}]),t}(l.a.PureComponent));_.defaultProps={showSavedMessages:!0};var w=h()({userStatusRoot:{position:"absolute",right:1,bottom:1,zIndex:1}})(_),M=a(400),N=a.n(M),T=a(409),L=(a(646),function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=e.chatId,a=e.onClick,n=e.classes;return l.a.createElement(N.a,{button:!0,className:n.listItem,onClick:a},l.a.createElement("div",{className:"recently-found-chat"},l.a.createElement("div",{className:"chat-wrapper"},l.a.createElement(j.a,{chatId:t,showSavedMessages:!0}),l.a.createElement("div",{className:"dialog-inner-wrapper"},l.a.createElement("div",{className:"tile-first-row"},l.a.createElement(T.a,{chatId:t}))))))}}]),t}(l.a.PureComponent)),F=h()({listItem:{padding:"0px"}})(L),D=a(396),R=a(16),A=(a(647),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateChatId=function(e){var t=e.nextChatId,n=e.previousChatId;a.setState({nextChatId:t,previousChatId:n})},a.handleClick=function(){var e=a.props,t=e.chatId,n=e.onSelect;n&&n(t)},a.state={nextChatId:R.a.getChatId(),previousChatId:null},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var a=this.props,n=a.chatId,o=a.theme;return t.nextChatId===n||(t.previousChatId===n||e.theme!==o)}},{key:"componentDidMount",value:function(){R.a.on("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"render",value:function(){var e,t=this.props,a=t.chatId,n=t.onClick,o=t.classes,r=this.state.nextChatId,s=Object(x.w)(a),c=Object(x.y)(a),i="";return c>0&&(i=1===c?", 1 subscriber":", ".concat(c," subscribers")),l.a.createElement(N.a,{button:!0,classes:{root:o.listItem},onClick:n},l.a.createElement("div",{className:d()("found-public-chat",(e={},Object(D.a)(e,o.listItemSelected,a===r),Object(D.a)(e,"accent-background",a===r),e)),onClick:this.handleClick},l.a.createElement(j.a,{chatId:a}),l.a.createElement("div",{className:"dialog-inner-wrapper"},l.a.createElement("div",{className:"tile-first-row"},l.a.createElement(T.a,{chatId:a})),l.a.createElement("div",{className:"tile-second-row"},l.a.createElement("div",{className:d()("dialog-content",o.foundPublicChatSubtitle)},"@",s,i)))))}}]),t}(l.a.Component)),P=h()(function(e){return{listItem:{padding:0},listItemSelected:{backgroundColor:e.palette.primary.main+"!important"},foundPublicChatSubtitle:{color:"dark"===e.palette.type?e.palette.text.secondary:"#70777b"}}},{withTheme:!0})(A),z=a(416),B=a(397),H=a(394),G=(a(648),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateChatId=function(e){a.setState(Object(m.a)({},e))},a.state={nextChatId:R.a.getChatId(),nextMessageId:R.a.getMessageId()},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var a=this.props,n=a.chatId,o=a.messageId,r=a.theme;return t.nextChatId===n&&t.nextMessageId===o||(t.previousChatId===n&&t.previousMessageId===o||e.theme!==r)}},{key:"componentDidMount",value:function(){R.a.on("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"render",value:function(){var e=this.props,t=e.chatId,a=e.messageId,n=e.chatSearch,o=e.onClick,r=e.classes,s=e.t,c=this.state.nextChatId,i=this.state.nextMessageId,u=H.a.get(t,a),p=u.sender_user_id,h=Object(x.C)(u),m=Object(x.E)(u),g=Object(x.D)(u),f=Object(B.b)(u,s)||"\xa0",C=p&&n?l.a.createElement(z.a,{userId:p}):l.a.createElement(j.a,{chatId:t});return l.a.createElement(N.a,{button:!0,className:r.listItem,onClick:o},l.a.createElement("div",{className:d()("found-message",Object(D.a)({},r.accentBackground,t===c&&a===i),{"accent-background":t===c&&a===i})},C,l.a.createElement("div",{className:"dialog-inner-wrapper"},l.a.createElement("div",{className:"tile-first-row"},n&&g?l.a.createElement("div",{className:"dialog-title"},g):l.a.createElement(T.a,{chatId:t}),l.a.createElement("div",{className:d()("dialog-meta-date",r.foundMessageSubtitle)},h)),l.a.createElement("div",{className:"tile-second-row"},l.a.createElement("div",{className:d()("dialog-content",r.foundMessageSubtitle)},l.a.createElement(l.a.Fragment,null,!n&&m&&l.a.createElement("span",{className:"dialog-content-accent"},m,": "),f))))))}}]),t}(l.a.Component)),q=Object(y.a)(h()(function(e){return{listItem:{padding:0},accentBackground:{background:e.palette.primary.main+"!important"},foundMessageSubtitle:{color:"dark"===e.palette.type?e.palette.text.secondary:"#70777b"}}},{withTheme:!0}),Object(U.c)())(G);a(649);var W=h()(function(e){return{searchCaption:{background:"dark"===e.palette.type?e.palette.grey[800]+"!important":"#f0f4f7",color:"dark"===e.palette.type?e.palette.text.primary+"!important":"#8096a8"},searchCaptionCommand:{color:"dark"===e.palette.type?e.palette.text.primary+"!important":"#8096a8"}}},{withTheme:!0})(function(e){var t=e.caption,a=e.command,n=e.onClick,o=e.classes;return l.a.createElement("div",{className:d()("search-caption",o.searchCaption)},l.a.createElement("div",{className:"search-caption-title"},t),Boolean(a)&&l.a.createElement("a",{className:o.searchCaptionCommand,onClick:n},a))}),V=a(393),$=a(456),K=a(30),J=a(27),Y=a(392),Q=a(69),X=a(45),Z=a(2),ee=(a(650),function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateSearchText=function(e){var t=e.text.trim();t?a.searchText(t):a.loadContent()},a.concatSearchResults=function(e){for(var t=[],a=new Map,n=0;n<e.length;n++){var o=e[n].chat_ids;if(o)for(var r=0;r<o.length;r++)a.has(o[r])||(a.set(o[r],o[r]),t.push(o[r]))}return t.sort(function(e,t){return Object(K.q)(Q.a.get(t).order,Q.a.get(e).order)}),t},a.searchText=function(){var e=Object(b.a)(C.a.mark(function e(t){var n,o,r,s,c,i,l,u,d,p,h,m,g,f,b,y,U,S,I,k,O,E,j,x;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.sessionId=new Date,a.text=t,n=a.sessionId,o=null,r=a.props.chatId,s=a.state.savedMessages,r){e.next=38;break}return c=[],i=Z.a.send({"@type":"searchChats",query:t,limit:100}),c.push(i),(l=Object($.b)(t))&&(u=Z.a.send({"@type":"searchChats",query:l,limit:100}),c.push(u)),(d=Object($.a)(t))&&(p=Z.a.send({"@type":"searchChats",query:d,limit:100}),c.push(p)),e.next=16,Promise.all(c.map(function(e){return e.catch(function(e){return null})}));case 16:if(h=e.sent,m=a.concatSearchResults(h),n===a.sessionId){e.next=20;break}return e.abrupt("return");case 20:if(s&&(g=a.props.t,f=t.toUpperCase(),((b=["SAVED MESSAGES",g("SavedMessages").toUpperCase()]).some(function(e){return e.includes(f)})||l&&b.some(function(e){return e.includes(l.toUpperCase())}))&&m.splice(0,0,s.id)),a.setState({top:null,recentlyFound:null,local:m,global:null,messages:null}),o=Y.a.getStore(),Object(V.l)(o,m),!(t.length>=J.Y)){e.next=38;break}return y=[],U=Z.a.send({"@type":"searchPublicChats",query:t}),y.push(U),l&&(S=Z.a.send({"@type":"searchPublicChats",query:l}),y.push(S)),e.next=31,Promise.all(y.map(function(e){return e.catch(function(e){return null})}));case 31:if(I=e.sent,k=a.concatSearchResults(I),n===a.sessionId){e.next=35;break}return e.abrupt("return");case 35:a.setState({global:k}),o=Y.a.getStore(),Object(V.l)(o,k);case 38:if(O=[],!r){e.next=45;break}return e.next=42,Z.a.send({"@type":"searchChatMessages",chat_id:r,query:t,sender_user_id:0,from_message_id:0,offset:0,limit:50,filter:null});case 42:O=e.sent,e.next=48;break;case 45:return e.next=47,Z.a.send({"@type":"searchMessages",query:t,offset_date:0,offset_chat_id:0,offset_message_id:0,limit:50});case 47:O=e.sent;case 48:if(H.a.setItems(O.messages),n===a.sessionId){e.next=51;break}return e.abrupt("return");case 51:for(a.setState({messages:O}),E=new Map,j=new Map,x=0;x<O.messages.length;x++)E.set(O.messages[x].chat_id,O.messages[x].chat_id),O.messages[x].sender_user_id&&j.set(O.messages[x].sender_user_id,O.messages[x].sender_user_id);o=Y.a.getStore(),Object(V.l)(o,Object(v.a)(E.keys())),Object(V.t)(o,Object(v.a)(j.keys()));case 58:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.loadContent=Object(b.a)(C.a.mark(function e(){var t,n,o,r,s,c,i,l,u;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.props.chatId){e.next=4;break}return a.setState({top:null,recentlyFound:null,local:null,global:null,messages:null}),e.abrupt("return");case 4:return t=Z.a.send({"@type":"getTopChats",category:{"@type":"topChatCategoryUsers"},limit:30}).catch(function(){return{"@type":"chats",chat_ids:[]}}),n=Z.a.send({"@type":"searchChats",query:"",limit:100}).catch(function(){return{"@type":"chats",chat_ids:[]}}),o=Z.a.send({"@type":"createPrivateChat",user_id:X.a.getMyId(),force:!0}).catch(function(e){}),e.next=9,Promise.all([t,n,o]);case 9:r=e.sent,s=Object(g.a)(r,3),c=s[0],i=s[1],l=s[2],a.setState({top:c,recentlyFound:i,savedMessages:l,local:null,global:null,messages:null}),u=Y.a.getStore(),Object(V.l)(u,c.chat_ids),Object(V.l)(u,i.chat_ids);case 18:case"end":return e.stop()}},e)})),a.handleRecentlyFound=Object(b.a)(C.a.mark(function e(){var t,a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.a.send({"@type":"getChats",offset_order:"9223372036854775807",offset_chat_id:0,limit:20});case 2:for(t=e.sent,a=t.chat_ids.length-1;a>=0;a--)Z.a.send({"@type":"addRecentlyFoundChat",chat_id:t.chat_ids[a]});case 4:case"end":return e.stop()}},e)})),a.handleClearRecentlyFound=function(e){e.stopPropagation(),Z.a.send({"@type":"clearRecentlyFoundChats"}),a.setState({recentlyFound:null})},a.handleSelectMessage=function(e,t,n,o){var r=a.props.onSelectMessage;n&&Z.a.send({"@type":"addRecentlyFoundChat",chat_id:e}),r(e,t,o)},a.handleScroll=function(){var e=a.listRef.current;e.scrollTop+e.offsetHeight===e.scrollHeight&&a.onLoadPrevious()},a.getOffset=function(e){var t=e?e.messages.length:0;return{offset_date:t>0?e.messages[t-1].date:0,offset_chat_id:t>0?e.messages[t-1].chat_id:0,offset_message_id:t>0?e.messages[t-1].id:0}},a.concatMessages=function(e,t){return t&&t.messages.length?e&&e.messages.length?{total_count:t.total_count,messages:e.messages.concat(t.messages)}:t:e},a.onLoadPrevious=Object(b.a)(C.a.mark(function e(){var t,n,o,r,s,c,i,l,u;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.loading){e.next=2;break}return e.abrupt("return");case 2:if(t=a.props.chatId,n=a.sessionId,o=a.state.messages,r=a.getOffset(o),a.loading=!0,s=[],!t){e.next=14;break}return e.next=11,Z.a.send({"@type":"searchChatMessages",chat_id:t,query:a.text,sender_user_id:0,from_message_id:r.offset_message_id,limit:50,filter:null});case 11:s=e.sent,e.next=17;break;case 14:return e.next=16,Z.a.send(Object(m.a)({"@type":"searchMessages",query:a.text},r,{limit:50}));case 16:s=e.sent;case 17:if(a.loading=!1,Object(B.a)(s,o?o.messages:[]),H.a.setItems(s.messages),n===a.sessionId){e.next=22;break}return e.abrupt("return");case 22:for(a.setState({messages:a.concatMessages(o,s)}),c=new Map,i=new Map,l=0;l<s.messages.length;l++)c.set(s.messages[l].chat_id,s.messages[l].chat_id),s.messages[l].sender_user_id&&i.set(s.messages[l].sender_user_id,s.messages[l].sender_user_id);u=Y.a.getStore(),Object(V.l)(u,Object(v.a)(c.keys())),Object(V.t)(u,Object(v.a)(i.keys()));case 29:case"end":return e.stop()}},e)})),a.handleTopChatsScroll=function(e){e.stopPropagation()},a.handleClose=function(){(0,a.props.onClose)()},a.listRef=l.a.createRef();var o=a.props,c=o.chatId,i=o.text;return a.state={prevPropsChatId:c,prevPropsText:i,top:null,recentlyFound:null,local:null,global:null,messages:null},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.loadContent(),R.a.on("clientUpdateSearchText",this.onClientUpdateSearchText)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateSearchText",this.onClientUpdateSearchText)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.chatId,o=this.state,r=o.top,s=o.recentlyFound,c=o.local,i=o.global,u=o.messages,p=Q.a.get(n),h=r&&r.chat_ids?r.chat_ids.map(function(t){return l.a.createElement(w,{key:t,chatId:t,onSelect:function(){return e.handleSelectMessage(t,null,!1,!1)}})}):[],m=s&&s.chat_ids?s.chat_ids.map(function(t){return l.a.createElement(F,{key:t,chatId:t,onClick:function(){return e.handleSelectMessage(t,null,!0,!1)}})}):[],g=c?c.map(function(t){return l.a.createElement(F,{key:t,chatId:t,onClick:function(){return e.handleSelectMessage(t,null,!0,!1)}})}):[],f=i?i.map(function(t){return l.a.createElement(P,{key:t,chatId:t,onClick:function(){return e.handleSelectMessage(t,null,!0,!0)}})}):[],C=u&&u.messages?u.messages.map(function(t){return l.a.createElement(q,{key:"".concat(t.chat_id,"_").concat(t.id),chatId:t.chat_id,messageId:t.id,chatSearch:Boolean(n),onClick:function(){return e.handleSelectMessage(t.chat_id,t.id,!1,!0)}})}):[],v="No messages found";return u&&u.total_count&&(v=1===u.total_count?"Found 1 message":"Found ".concat(u.total_count," messages")),l.a.createElement("div",{ref:this.listRef,className:d()(a.search,"search"),onScroll:this.handleScroll},p&&l.a.createElement("div",{className:"search-chat"},l.a.createElement(W,{caption:"Search messages in"}),l.a.createElement("div",{className:"search-chat-wrapper"},l.a.createElement("div",{className:"search-chat-control"},l.a.createElement(E.a,{chatId:n,showStatus:!1})),l.a.createElement(O.a,{className:a.closeSearchIconButton,"aria-label":"Search",onMouseDown:this.handleClose},l.a.createElement(I.a,null)))),h.length>0&&l.a.createElement("div",{className:"search-top-chats"},l.a.createElement(W,{caption:"People"}),l.a.createElement("div",{className:"search-top-chats-list",onScroll:this.handleTopChatsScroll},l.a.createElement("div",{className:"search-top-chats-placeholder"}),h,l.a.createElement("div",{className:"search-top-chats-placeholder"}))),m.length>0&&l.a.createElement("div",{className:"search-recently-found-chats"},l.a.createElement(W,{caption:"Recent",command:"Clear",onClick:this.handleClearRecentlyFound}),m),g.length>0&&l.a.createElement("div",{className:"search-local-chats"},l.a.createElement(W,{caption:"Chats and contacts"}),g),f.length>0&&l.a.createElement("div",{className:"search-global-chats"},l.a.createElement(W,{caption:"Global search"}),f),u&&l.a.createElement("div",{className:"search-global-chats"},l.a.createElement(W,{caption:v}),C))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.chatId!==t.prevPropsChatId||e.text!==t.prevPropsText?{prevPropsChatId:e.chatId,prevPropsText:e.text,top:null,recentlyFound:null,local:null,global:null,messages:null}:null}}]),t}(l.a.Component)),te=Object(y.a)(h()(function(e){return{closeSearchIconButton:{margin:"8px 12px 8px 0"},listItem:{padding:"0px"},search:{background:"dark"===e.palette.type?e.palette.background.default:"#FFFFFF"}}},{withTheme:!0}),Object(U.c)())(ee),ae=a(656),ne=a(445),oe=a.n(ne),re=a(509),se=a.n(re),ce=a(9),ie=a(655),le=a.n(ie),ue=a(414),de=a.n(ue),pe=a(411),he=a.n(pe),me=a(78),ge=a.n(me),fe=a(80),Ce=a.n(fe),ve=a(79),be=a.n(ve),ye=a(419),Ue=a.n(ye),Se=a(444),Ie=a.n(Se),ke=a(412),Oe=a.n(ke),Ee=a(49),je=a.n(Ee),xe=a(187),_e=a.n(xe),we=a(200),Me=a.n(we),Ne=a(651),Te=a.n(Ne),Le=a(208),Fe=a.n(Le),De=a(207),Re=a.n(De),Ae=a(144),Pe=a.n(Ae),ze=a(199),Be=a.n(ze),He=a(652),Ge=a.n(He),qe=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).handleChange=function(e){a.setState({type:e.target.value}),R.a.emit("clientUpdateThemeChanging",{type:e.target.value,primary:a.getColor(a.state.color)})},a.handleAccentChange=function(e){a.setState({color:e.target.value}),R.a.emit("clientUpdateThemeChanging",{type:a.state.type,primary:a.getColor(e.target.value)})},a.getColorString=function(e){switch(e){case Me.a[500]:return"red";case Te.a[500]:return"orange";case Fe.a[500]:return"amber";case Re.a[500]:return"green";case Pe.a[500]:return"blue";case Be.a[500]:return"indigo";case Ge.a[500]:return"deepPurple"}return null},a.getColor=function(e){switch(e){case"red":return Me.a;case"orange":return Te.a;case"amber":return Fe.a;case"green":return Re.a;case"blue":return Pe.a;case"indigo":return Be.a;case"deepPurple":return Ge.a}return null},a.handleClose=function(){a.setState({open:!1})},a.open=function(){a.setState({open:!0})},a.state={open:!1,type:a.props.theme.palette.type,color:a.getColorString(a.props.theme.palette.primary.main)},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.classes,t=this.state,a=t.type,n=t.color;return l.a.createElement(ge.a,{transitionDuration:0,open:this.state.open,onClose:this.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},l.a.createElement(be.a,{id:"alert-dialog-title"},"Appearance"),l.a.createElement(Ce.a,null,l.a.createElement(je.a,{component:"fieldset",className:e.formControl},l.a.createElement(_e.a,{focused:!0,component:"legend"},"Theme"),l.a.createElement(Ie.a,{"aria-label":"theme",name:"theme1",className:e.group,value:a,onChange:this.handleChange},l.a.createElement(Oe.a,{value:"light",control:l.a.createElement(Ue.a,{color:"primary"}),label:"Light"}),l.a.createElement(Oe.a,{value:"dark",control:l.a.createElement(Ue.a,{color:"primary"}),label:"Dark"}))),l.a.createElement(je.a,{component:"fieldset",className:e.formControl},l.a.createElement(_e.a,{focused:!0,component:"legend"},"Accent"),l.a.createElement(Ie.a,{"aria-label":"accent",name:"accent1",className:e.group,value:n,onChange:this.handleAccentChange},l.a.createElement(Oe.a,{value:"red",control:l.a.createElement(Ue.a,{classes:{root:e.redRoot,checked:e.checked}}),label:"Red"}),l.a.createElement(Oe.a,{value:"orange",control:l.a.createElement(Ue.a,{classes:{root:e.orangeRoot,checked:e.checked}}),label:"Orange"}),l.a.createElement(Oe.a,{value:"amber",control:l.a.createElement(Ue.a,{classes:{root:e.amberRoot,checked:e.checked}}),label:"Amber"}),l.a.createElement(Oe.a,{value:"green",control:l.a.createElement(Ue.a,{classes:{root:e.greenRoot,checked:e.checked}}),label:"Green"}),l.a.createElement(Oe.a,{value:"blue",control:l.a.createElement(Ue.a,{classes:{root:e.blueRoot,checked:e.checked}}),label:"Blue"}),l.a.createElement(Oe.a,{value:"indigo",control:l.a.createElement(Ue.a,{classes:{root:e.indigoRoot,checked:e.checked}}),label:"Indigo"}),l.a.createElement(Oe.a,{value:"deepPurple",control:l.a.createElement(Ue.a,{classes:{root:e.deepPurpleRoot,checked:e.checked}}),label:"Deep Purple"})))))}}]),t}(l.a.Component),We=h()(function(e){return{formControl:{margin:3*e.spacing.unit},group:{margin:"".concat(e.spacing.unit,"px 0")},redRoot:{color:Me.a[600],"&$checked":{color:Me.a[500]}},orangeRoot:{color:Te.a[600],"&$checked":{color:Te.a[500]}},amberRoot:{color:Fe.a[600],"&$checked":{color:Fe.a[500]}},greenRoot:{color:Re.a[600],"&$checked":{color:Re.a[500]}},blueRoot:{color:Pe.a[600],"&$checked":{color:Pe.a[500]}},indigoRoot:{color:Be.a[600],"&$checked":{color:Be.a[500]}},deepPurpleRoot:{color:Ge.a[600],"&$checked":{color:Ge.a[500]}},checked:{}}},{withTheme:!0})(qe),Ve=a(54),$e=a(87),Ke=function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).handleChange=function(e){a.setState({language:e.target.value}),Z.a.clientUpdate({"@type":"clientUpdateLanguageChange",language:e.target.value})},a.handleClose=function(){a.setState({open:!1})},a.open=function(){a.setState({open:!0})};var o=e.i18n,c=o?o.language:null;return a.state={open:!1,language:c||"en"},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.classes,e.t),a=this.state,n=a.open,o=a.language,r=($e.a.info||{language_packs:[]}).language_packs.map(function(e){return l.a.createElement(Oe.a,{key:e.id,value:e.id,control:l.a.createElement(Ue.a,{color:"primary"}),label:"".concat(e.name,"\xa0(").concat(e.native_name,")")})});return l.a.createElement(ge.a,{transitionDuration:0,open:n,onClose:this.handleClose,"aria-labelledby":"language-dialog-title","aria-describedby":"language-dialog-description"},l.a.createElement(be.a,{id:"language-dialog-title"},t("Language")),l.a.createElement(Ce.a,null,l.a.createElement(je.a,{component:"fieldset"},l.a.createElement(Ie.a,{"aria-label":"language",name:"language1",value:o,onChange:this.handleChange},r))))}}]),t}(l.a.Component),Je=Object(y.a)(Object(Ve.c)(),Object(U.c)(),h()(function(e){return{formControl:{margin:3*e.spacing.unit},group:{margin:"".concat(e.spacing.unit,"px 0")}}},{withTheme:!0}),Object(Ve.b)())(Ke),Ye=a(67),Qe={vertical:"bottom",horizontal:"left"},Xe=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onUpdateAuthorizationState=function(e){a.setState({authorizationState:e.authorization_state})},a.handleMenuOpen=function(e){var t=a.state.authorizationState;Object(K.n)(t)&&a.setState({anchorEl:e.currentTarget})},a.handleMenuClose=function(){a.setState({anchorEl:null})},a.handleLogOut=function(){a.handleMenuClose(),a.props.onLogOut()},a.handleCheckUpdates=Object(b.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.handleMenuClose(),e.next=3,Object(Ye.b)();case 3:case"end":return e.stop()}},e)})),a.handleAppearance=function(e){a.handleMenuClose(),a.themePicker.open()},a.handleLanguage=function(e){a.handleMenuClose(),a.languagePicker.open()},a.setRef=function(e){console.log(Object(ce.a)(Object(ce.a)(a))),a.languagePicker=e},a.state={authorizationState:R.a.getAuthorizationState(),anchorEl:null},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){R.a.on("updateAuthorizationState",this.onUpdateAuthorizationState)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("updateAuthorizationState",this.onUpdateAuthorizationState)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.t,o=this.state,r=o.anchorEl,s=o.authorizationState,c=Object(K.n)(s)?l.a.createElement(l.a.Fragment,null,l.a.createElement(de.a,{id:"main-menu",anchorEl:r,open:Boolean(r),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:Qe},l.a.createElement(he.a,{onClick:this.handleCheckUpdates},n("UpdateTelegram")),l.a.createElement(he.a,{onClick:this.handleAppearance},n("Appearance")),l.a.createElement(he.a,{onClick:this.handleLanguage},n("Language")),l.a.createElement(he.a,{onClick:this.handleLogOut},n("LogOut")))):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(O.a,{"aria-owns":r?"simple-menu":null,"aria-haspopup":"true",className:a.menuIconButton,"aria-label":"Menu",onClick:this.handleMenuOpen},l.a.createElement(le.a,null)),c,l.a.createElement(We,{innerRef:function(t){return e.themePicker=t}}),l.a.createElement(Je,{ref:function(t){return e.languagePicker=t}}))}}]),t}(l.a.Component),Ze=Object(y.a)(Object(U.c)(),h()({menuIconButton:{margin:"8px -2px 8px 12px"},searchIconButton:{margin:"8px 12px 8px 0"}},{withTheme:!0}))(Xe),et=(a(470),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onUpdateAuthorizationState=function(e){a.setState({authorizationState:e.authorization_state})},a.handleLogOut=function(){a.setState({open:!0})},a.handleDone=function(){a.handleClose(),Z.a.logOut()},a.handleClose=function(){a.setState({open:!1})},a.handleSearch=function(){var e=a.props,t=e.onSearch,n=e.openSearch,o=a.state.authorizationState;Object(K.n)(o)&&t(!n)},a.handleKeyDown=function(e){13===e.keyCode&&e.preventDefault()},a.handleKeyUp=function(){var e=a.searchInput.current.innerText,t=a.searchInput.current.innerHTML;!t||"<br>"!==t&&"<div><br></div>"!==t||(a.searchInput.current.innerHTML=""),R.a.emit("clientUpdateSearchText",{text:e})},a.handlePaste=function(e){var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertHTML",!1,t))},a.searchInput=l.a.createRef(),a.state={authorizationState:R.a.getAuthorizationState(),open:!1},a.handleInput=Object(K.c)(a.handleInput,250),a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){var n=this;this.props.openSearch&&this.props.openSearch!==e.openSearch&&setTimeout(function(){n.searchInput.current&&n.searchInput.current.focus()},250)}},{key:"componentDidMount",value:function(){R.a.on("updateAuthorizationState",this.onUpdateAuthorizationState)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("updateAuthorizationState",this.onUpdateAuthorizationState)}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.onClick,n=e.openSearch,o=e.t,r=this.state.open,s=r?l.a.createElement(ae.b,{transitionDuration:0,open:r,onClose:this.handleClose,"aria-labelledby":"form-dialog-title"},l.a.createElement(ae.f,{id:"form-dialog-title"},o("AppName")),l.a.createElement(ae.d,null,l.a.createElement(ae.e,{className:t.dialogText},o("AreYouSureLogout"))),l.a.createElement(ae.c,null,l.a.createElement(ae.a,{onClick:this.handleClose,color:"primary"},o("Cancel")),l.a.createElement(ae.a,{onClick:this.handleDone,color:"primary"},o("Ok")))):null;return l.a.createElement("div",{className:"header-master"},n?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"header-search-input grow"},l.a.createElement("div",{id:"header-search-inputbox",ref:this.searchInput,placeholder:o("Search"),key:Date(),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste}))):l.a.createElement(l.a.Fragment,null,l.a.createElement(Ze,{onLogOut:this.handleLogOut}),s,l.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:a},l.a.createElement("span",{className:"header-status-content"},o("AppName")))),l.a.createElement(ae.g,{className:t.headerIconButton,"aria-label":o("Search"),onMouseDown:this.handleSearch},l.a.createElement(se.a,{open:n,icon:l.a.createElement(oe.a,null),openIcon:l.a.createElement(I.a,null)})))}}]),t}(l.a.Component)),tt=Object(y.a)(Object(U.c)(),h()({headerIconButton:{margin:"8px 12px 8px 0"},dialogText:{whiteSpace:"pre-wrap"}}))(et),at=(a(659),a(676),function(e){function t(){var e,a;Object(n.a)(this,t);for(var o=arguments.length,c=new Array(o),i=0;i<o;i++)c[i]=arguments[i];return(a=Object(r.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(c)))).onClientUpdateClearHistory=function(e){a.props.chatId===e.chatId&&(a.clearHistory=e.inProgress,a.forceUpdate())},a.onFastUpdatingComplete=function(e){a.forceUpdate()},a.onUpdate=function(e){a.props.chatId===e.chat_id&&a.forceUpdate()},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId||e.t!==this.props.t}},{key:"componentDidMount",value:function(){Q.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.on("updateChatDraftMessage",this.onUpdate),Q.a.on("updateChatLastMessage",this.onUpdate),Q.a.on("updateChatReadInbox",this.onUpdate),Q.a.on("updateUserChatAction",this.onUpdate)}},{key:"componentWillUnmount",value:function(){Q.a.removeListener("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.removeListener("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.removeListener("updateChatDraftMessage",this.onUpdate),Q.a.removeListener("updateChatLastMessage",this.onUpdate),Q.a.removeListener("updateChatReadInbox",this.onUpdate),Q.a.removeListener("updateUserChatAction",this.onUpdate)}},{key:"render",value:function(){var e=this.props,t=e.chatId,a=e.t;if(this.clearHistory)return l.a.createElement("div",{className:"dialog-content"},"\xa0");var n=Q.a.get(t);if(!n)return l.a.createElement("div",{className:"dialog-content"},"\xa0");var o=null,r=Object(x.r)(t);if(r&&(o=l.a.createElement("span",{className:"dialog-content-accent"},r)),!o){var s=Object(x.i)(t);if(Object(x.S)(t)){var c=s.text||"\xa0";o=l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"dialog-content-draft"},a("Draft")+": "),c)}}if(!o){var i=Object(x.z)(n,a)||"\xa0",u=Object(x.B)(n);o=l.a.createElement(l.a.Fragment,null,u&&l.a.createElement("span",{className:"dialog-content-accent"},u,": "),i)}return l.a.createElement("div",{className:"dialog-content"},o)}}]),t}(l.a.Component)),nt=Object(U.c)()(at),ot=(a(677),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateClearHistory=function(e){a.props.chatId===e.chatId&&(a.clearHistory=e.inProgress,a.forceUpdate())},a.onFastUpdatingComplete=function(e){a.forceUpdate()},a.onUpdate=function(e){var t=a.props.chatId;e.chat_id===t&&a.forceUpdate()},a.onUpdateScopeNotificationSettings=function(e){var t=a.props.chatId,n=Q.a.get(t);if(n)switch(e.scope["@type"]){case"notificationSettingsScopeGroupChats":"chatTypeBasicGroup"!==n.type["@type"]&&"chatTypeSupergroup"!==n.type["@type"]||a.forceUpdate();break;case"notificationSettingsScopePrivateChats":"chatTypePrivate"!==n.type["@type"]&&"chatTypeSecret"!==n.type["@type"]||a.forceUpdate()}},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId||e.theme!==this.props.theme}},{key:"componentDidMount",value:function(){Q.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.on("updateChatDraftMessage",this.onUpdate),Q.a.on("updateChatIsMarkedAsUnread",this.onUpdate),Q.a.on("updateChatIsPinned",this.onUpdate),Q.a.on("updateChatNotificationSettings",this.onUpdate),Q.a.on("updateChatReadInbox",this.onUpdate),Q.a.on("updateChatReadOutbox",this.onUpdate),Q.a.on("updateChatUnreadMentionCount",this.onUpdate),R.a.on("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}},{key:"componentWillUnmount",value:function(){Q.a.removeListener("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.removeListener("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.removeListener("updateChatDraftMessage",this.onUpdate),Q.a.removeListener("updateChatIsMarkedAsUnread",this.onUpdate),Q.a.removeListener("updateChatIsPinned",this.onUpdate),Q.a.removeListener("updateChatNotificationSettings",this.onUpdate),Q.a.removeListener("updateChatReadInbox",this.onUpdate),Q.a.removeListener("updateChatReadOutbox",this.onUpdate),Q.a.removeListener("updateChatUnreadMentionCount",this.onUpdate),R.a.removeListener("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}},{key:"render",value:function(){if(this.clearHistory)return null;var e=this.props,t=e.classes,a=e.chatId,n=Q.a.get(a);if(!n)return null;n.draft_message;var o=Object(x.u)(n),r=Object(x.s)(n),s=Object(x.t)(n),c=r>1||1===r&&s<1,i=Object(x.S)(n.id),u=Object(x.N)(n)?"dialog-badge-muted":"";return l.a.createElement(l.a.Fragment,null,o&&!i&&l.a.createElement("i",{className:"dialog-badge-unread"}),s&&l.a.createElement("div",{className:d()("dialog-badge",t.dialogBadge)},l.a.createElement("div",{className:"dialog-badge-mention"},"@")),c?l.a.createElement("div",{className:d()(u,"dialog-badge",t.dialogBadge)},l.a.createElement("span",{className:"dialog-badge-text"},r)):n.is_pinned&&!o?l.a.createElement("i",{className:"dialog-badge-pinned"}):null)}}]),t}(l.a.Component)),rt=h()(function(e){return{dialogBadge:{background:e.palette.primary.main}}},{withTheme:!0})(ot),st=(a(678),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateClearHistory=function(e){a.props.chatId===e.chatId&&(a.clearHistory=e.inProgress,a.forceUpdate())},a.onFastUpdatingComplete=function(e){a.forceUpdate()},a.onUpdate=function(e){a.props.chatId===e.chat_id&&a.forceUpdate()},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId}},{key:"componentDidMount",value:function(){Q.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.on("updateChatDraftMessage",this.onUpdate),Q.a.on("updateChatLastMessage",this.onUpdate),Q.a.on("updateChatReadInbox",this.onUpdate),Q.a.on("updateChatUnreadMentionCount",this.onUpdate),Q.a.on("updateMessageMentionRead",this.onUpdate)}},{key:"componentWillUnmount",value:function(){Q.a.removeListener("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.removeListener("clientUpdateClearHistory",this.onClientUpdateClearHistory),Q.a.removeListener("updateChatDraftMessage",this.onUpdate),Q.a.removeListener("updateChatLastMessage",this.onUpdate),Q.a.removeListener("updateChatReadInbox",this.onUpdate),Q.a.removeListener("updateChatUnreadMentionCount",this.onUpdate),Q.a.removeListener("updateMessageMentionRead",this.onUpdate)}},{key:"render",value:function(){if(this.clearHistory)return null;var e=this.props.chatId,t=Q.a.get(e),a=Object(x.A)(t);return l.a.createElement(l.a.Fragment,null,a&&l.a.createElement("div",{className:"dialog-meta-date"},a))}}]),t}(l.a.Component)),ct=a(121),it=(a(679),function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateChatId=function(e){var t=a.props.chatId;t!==e.previousChatId&&t!==e.nextChatId||a.forceUpdate()},a.handleSelect=function(){Object(ct.b)(a.props.chatId)},a.dialog=l.a.createRef();var o=Q.a.get(a.props.chatId);return a.state={chat:o},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.chatId!==this.props.chatId||(e.theme!==this.props.theme||e.hidden!==this.props.hidden)}},{key:"componentDidMount",value:function(){R.a.on("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateChatId",this.onClientUpdateChatId)}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.chatId,n=e.showSavedMessages;if(e.hidden)return null;var o=R.a.getChatId()===a;return l.a.createElement("div",{ref:this.dialog,className:d()(o?t.dialogActive:t.dialog,o?"dialog-active":"dialog"),onMouseDown:this.handleSelect},l.a.createElement("div",{className:"dialog-wrapper"},l.a.createElement(j.a,{chatId:a,showSavedMessages:n,showOnline:!0,classes:{statusRoot:t.statusRoot,statusIcon:t.statusIcon}}),l.a.createElement("div",{className:"dialog-inner-wrapper"},l.a.createElement("div",{className:"tile-first-row"},l.a.createElement(T.a,{chatId:a}),l.a.createElement(st,{chatId:a})),l.a.createElement("div",{className:"tile-second-row"},l.a.createElement(nt,{chatId:a}),l.a.createElement(rt,{chatId:a})))))}}]),t}(i.Component));it.defaultProps={hidden:!1,showSavedMessages:!0};var lt=h()(function(e){return{statusRoot:{position:"absolute",right:1,bottom:1,zIndex:1},statusIcon:{},dialogActive:{color:"#fff",backgroundColor:e.palette.primary.main,borderRadius:8,cursor:"pointer",margin:"0 12px","& $statusRoot":{background:e.palette.primary.main}},dialog:{borderRadius:8,cursor:"pointer",margin:"0 12px","&:hover":{backgroundColor:e.palette.primary.main+"22","& $statusRoot":{background:"dark"===e.palette.type?e.palette.background.default:"#FFFFFF"},"& $statusIcon":{background:e.palette.primary.main+"22"}}}}},{withTheme:!0})(it),ut=a(408),dt=a(401),pt=(a(680),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateLeaveChat=function(e){e.inProgress?a.hiddenChats.set(e.chatId,e.chatId):a.hiddenChats.delete(e.chatId),a.forceUpdate()},a.onUpdateAuthorizationState=function(e){var t=e.authorization_state;a.setState({authorizationState:t},function(){return a.loadFirstSlice()})},a.onFastUpdatingComplete=function(e){a.onLoadNext(!0)},a.onUpdateConnectionState=function(e){console.log(Object(ce.a)(Object(ce.a)(a)));var t=e.state,n=a.state.connectionState;(a.setState({connectionState:t}),n&&"connectionStateUpdating"===n["@type"]&&"connectionStateUpdating"!==t["@type"])&&(Q.a.skippedUpdates.length>0&&(Q.a.skippedUpdates=[],a.setState({chats:[]},function(){return a.onLoadNext(!0)})))},a.loadFirstSlice=Object(b.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=a.state.authorizationState)||"authorizationStateReady"!==t["@type"]){e.next=4;break}return e.next=4,Y.a.initDB(function(){return a.onLoadNext()});case 4:case"end":return e.stop()}},e)})),a.onUpdateChatOrder=function(e){if("0"===e.order&&Q.a.get(e.chat_id)){e.chat_id===R.a.getChatId()&&(Z.a.setChatId(0),R.a.changeChatDetailsVisibility(!1));for(var t=[],n=0;n<a.state.chats.length;n++){var o=Q.a.get(a.state.chats[n]);if(o&&"0"!==o.order)switch(o.type["@type"]){case"chatTypeBasicGroup":"chatMemberStatusLeft"!==ut.a.get(o.type.basic_group_id).status["@type"]&&t.push(o.id);break;case"chatTypePrivate":case"chatTypeSecret":t.push(o.id);break;case"chatTypeSupergroup":"chatMemberStatusLeft"!==dt.a.get(o.type.supergroup_id).status["@type"]&&t.push(o.id)}}a.reorderChats(t)}},a.onUpdate=function(e){var t=e.chat_id;if("0"!==e.order){var n=Q.a.get(t);if(n&&"0"!==n.order){var o=a.state.chats,r=[];if(o.length>0)if(!o.find(function(e){return e===t})){var s=Q.a.get(o[o.length-1]).order;if(1===Object(K.q)(s,n.order))return;r.push(n.id)}for(var c=[],i=0;i<o.length;i++){var l=Q.a.get(o[i]);if(l&&"0"!==l.order)switch(l.type["@type"]){case"chatTypeBasicGroup":"chatMemberStatusLeft"!==ut.a.get(l.type.basic_group_id).status["@type"]&&c.push(l.id);break;case"chatTypePrivate":case"chatTypeSecret":c.push(l.id);break;case"chatTypeSupergroup":"chatMemberStatusLeft"!==dt.a.get(l.type.supergroup_id).status["@type"]&&c.push(l.id)}}a.reorderChats(c,r,function(){a.loadChatContents(r)})}}},a.handleScroll=function(){var e=a.listRef.current;e&&e.scrollTop+e.offsetHeight>=e.scrollHeight&&a.onLoadNext()},a.onLoadNext=Object(b.a)(C.a.mark(function e(){var t,n,o,r,s,c,i=arguments;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],n=a.state.chats,!a.loading){e.next=4;break}return e.abrupt("return");case 4:return o="9223372036854775807",r=0,!t&&n&&n.length>0&&(s=Q.a.get(n[n.length-1]))&&(o=s.order,r=s.id),a.loading=!0,e.next=10,Z.a.send({"@type":"getChats",offset_chat_id:r,offset_order:o,limit:J.c}).finally(function(){a.loading=!1});case 10:(c=e.sent).chat_ids.length>0&&c.chat_ids[0]===r&&c.chat_ids.shift(),t?a.replaceChats(c.chat_ids,function(){return a.loadChatContents(c.chat_ids)}):a.appendChats(c.chat_ids,function(){return a.loadChatContents(c.chat_ids)});case 13:case"end":return e.stop()}},e)})),a.hiddenChats=new Map,a.listRef=l.a.createRef(),a.state={chats:[],authorizationState:R.a.getAuthorizationState(),connectionState:R.a.getConnectionState()},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.chats!==this.state.chats}},{key:"getSnapshotBeforeUpdate",value:function(e,t){return{scrollTop:this.listRef.current.scrollTop}}},{key:"componentDidUpdate",value:function(e,t,a){var n=this.listRef.current,o=a.scrollTop;n.scrollTop=o}},{key:"componentDidMount",value:function(){this.loadFirstSlice(),R.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),Q.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.on("updateChatDraftMessage",this.onUpdate),Q.a.on("updateChatIsPinned",this.onUpdate),Q.a.on("updateChatLastMessage",this.onUpdate),Q.a.on("updateChatOrder",this.onUpdateChatOrder),Q.a.on("clientUpdateLeaveChat",this.onClientUpdateLeaveChat)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("updateAuthorizationState",this.onUpdateAuthorizationState),Q.a.removeListener("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Q.a.removeListener("updateChatDraftMessage",this.onUpdate),Q.a.removeListener("updateChatIsPinned",this.onUpdate),Q.a.removeListener("updateChatLastMessage",this.onUpdate),Q.a.removeListener("updateChatOrder",this.onUpdateChatOrder),Q.a.removeListener("clientUpdateLeaveChat",this.onClientUpdateLeaveChat)}},{key:"reorderChats",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,o=e.concat(a).sort(function(e,t){return Object(K.q)(Q.a.get(t).order,Q.a.get(e).order)});t.isDifferentOrder(this.state.chats,o)&&this.setState({chats:o},n)}},{key:"loadChatContents",value:function(e){var t=Y.a.getStore();Object(V.l)(t,e)}},{key:"appendChats",value:function(e,t){0!==e.length&&this.setState({chats:this.state.chats.concat(e)},t)}},{key:"replaceChats",value:function(e,t){this.setState({chats:e},t)}},{key:"scrollToTop",value:function(){this.listRef.current.scrollTop=0}},{key:"render",value:function(){var e=this,t=this.state.chats.map(function(t){return l.a.createElement(lt,{key:t,chatId:t,hidden:e.hiddenChats.has(t)})});return l.a.createElement("div",{ref:this.listRef,className:"dialogs-list",onScroll:this.handleScroll},t)}}],[{key:"isDifferentOrder",value:function(e,t){if(e.length===t.length){for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!0;return!1}return!0}}]),t}(l.a.Component)),ht=a(32),mt=a.n(ht),gt=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateNewContentAvailable=function(){a.setState({newContentAvailable:!0})},a.handleUpdate=function(){a.handled||(a.handled=!0,setTimeout(function(){window.location.reload()},250))},a.state={newContentAvailable:!1},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){R.a.on("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable)}},{key:"render",value:function(){var e=this.state.newContentAvailable,t=this.props.classes,a=e?l.a.createElement(mt.a,{variant:"contained",color:"primary",className:t.root,onClick:this.handleUpdate},"Update"):null;return l.a.createElement(l.a.Fragment,null,a)}}]),t}(l.a.Component),ft=h()({root:{margin:0,padding:"24px",width:"100%",borderRadius:0,color:"white",maxHeight:"65px"}})(gt),Ct=a(398),vt=(a(681),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(s.a)(t).call(this,e))).onClientUpdateThemeChange=function(e){a.forceUpdate()},a.onClientUpdateChatDetailsVisibility=function(e){a.setState({isChatDetailsVisible:R.a.isChatDetailsVisible})},a.onClientUpdateSearchChat=function(e){a.setState({openSearch:!0,searchChatId:e.chatId,searchText:null})},a.handleHeaderClick=function(){a.dialogsList.current.scrollToTop()},a.handleSearch=function(e){a.setState({openSearch:e,searchChatId:0,searchText:null})},a.handleSelectMessage=function(e,t,n){var o=a.props.onSelectChat;Object(ct.b)(e,t),o(e,t);var r=n?a.state.searchChatId:0,s=n?a.state.searchText:null;a.setState({openSearch:n,searchChatId:r,searchText:s})},a.handleClose=function(){a.setState({openSearch:!1,searchChatId:0,searchText:null})},a.handleSearchTextChange=function(e){a.setState({searchText:e})},a.dialogsList=l.a.createRef(),a.state={isChatDetailsVisible:R.a.isChatDetailsVisible,openSearch:!1,searchChatId:0,searchText:null},a}return Object(c.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.isChatDetailsVisible!==this.state.isChatDetailsVisible||(t.openSearch!==this.state.openSearch||(t.searchChatId!==this.state.searchChatId||t.searchText!==this.state.searchText))}},{key:"componentDidMount",value:function(){R.a.on("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),R.a.on("clientUpdateSearchChat",this.onClientUpdateSearchChat),R.a.on("clientUpdateThemeChange",this.onClientUpdateThemeChange)}},{key:"componentWillUnmount",value:function(){R.a.removeListener("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),R.a.removeListener("clientUpdateSearchChat",this.onClientUpdateSearchChat),R.a.removeListener("clientUpdateThemeChange",this.onClientUpdateThemeChange)}},{key:"render",value:function(){var e=this.props.classes,t=this.state,a=t.isChatDetailsVisible,n=t.openSearch,o=t.searchChatId,r=t.searchText;return l.a.createElement("div",{className:d()(e.borderColor,"dialogs",{"dialogs-third-column":a})},l.a.createElement(tt,{openSearch:n,onClick:this.handleHeaderClick,onSearch:this.handleSearch,onSearchTextChange:this.handleSearchTextChange}),l.a.createElement("div",{className:"dialogs-content"},l.a.createElement(pt,{ref:this.dialogsList}),n&&l.a.createElement(te,{chatId:o,text:r,onSelectMessage:this.handleSelectMessage,onClose:this.handleClose})),l.a.createElement(ft,null))}}]),t}(i.Component));t.default=h()(Ct.b)(vt)}}]);
//# sourceMappingURL=7.a86dc84d.chunk.js.map